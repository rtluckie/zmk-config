/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>
// #include <dt-bindings/zmk/mouse.h>
#include <dt-bindings/zmk/outputs.h>

#ifndef KEYMAP_DRAWER
#include "include/keys_de.h"
#endif

#define DEF    0
#define NAV    1
#define NUM    2
#define FUN    3
#define MSE    4
#define MSE_F  5


#include "include/keypos.h"
#include "keycodes.dtsi"
#include "behaviors.dtsi"
#include "combos.dtsi"
#include "macros.dtsi"
#include "mouse.dtsi"

/ {
    conditional_layers {
        compatible = "zmk,conditional-layers";

        tri_layer  {
            if-layers = <NAV NUM>;
            then-layer = <FUN>;
        };
    };

    keymap {
        compatible = "zmk,keymap";

        default {
            display-name = "DEF";
            bindings = <LAYER_FROM42( \
// ┌─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────╥─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐
    &bootloader,      &kp Q,            &kp W,            &hrml LHYP E,     &kp R,            &kp T,            &kp Y,            &kp U,            &hrmr RHYP I,            &kp O,            &kp P,     &bootloader,     \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &kp A,            &hrml LCTL S,     &hrml LALT D,     &hrsl LSHIFT F,   &kp G,             &kp H,            &hrsr RSHFT J,    &hrmr RALT K,    &hrmr RCTRL L,     &kp SEMI,         &key_repeat,     \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &to MSE,            &kp Z,            &hrml LGUI X,     &hrml LMEH C,     &hrml LGUI V,     &kp B,             &kp N,            &hrmr RGUI M,     &mm_comma_semi_meh,  &mm_dot_colon_gui,   &mm_qexcl,           &none,           \
// └─────────────────┴─────────────────┴─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┴─────────────────┴─────────────────┘
                                                          &none,            &mm_bspc_del,        &gresc,           &lt_e NUM 0,      &kp SPACE,          &kp RET            \
//                                                       └─────────────────┴─────────────────┴─────────────────╨─────────────────┴─────────────────┴─────────────────┘
            )>;
        };

        navigation {
            display-name = "NAV";
            bindings = <LAYER_FROM42( \
// ┌─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────╥─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// └─────────────────┴─────────────────┴─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┴─────────────────┴─────────────────┘
                                                          &none,            &none,            &none,            &none,            &none,            &none            \
//                                                       └─────────────────┴─────────────────┴─────────────────╨─────────────────┴─────────────────┴─────────────────┘
            )>;
        };

        number {
            display-name = "NUM";
            bindings = <LAYER_FROM42( \
// ┌─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────╥─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// └─────────────────┴─────────────────┴─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┴─────────────────┴─────────────────┘
                                                          &none,            &none,            &none,            &none,            &none,            &none            \
//                                                       └─────────────────┴─────────────────┴─────────────────╨─────────────────┴─────────────────┴─────────────────┘
            )>;
        };

        function {
            display-name = "FUN";
            bindings = <LAYER_FROM42( \
// ┌─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────╥─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,            &none,           \
// └─────────────────┴─────────────────┴─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┴─────────────────┴─────────────────┘
                                                          &none,            &none,            &none,            &none,            &none,            &none            \
//                                                       └─────────────────┴─────────────────┴─────────────────╨─────────────────┴─────────────────┴─────────────────┘
            )>;
        };
        mouse {
            display-name = "MSE";
            bindings = <LAYER_FROM42( \
// ┌─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────╥─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐
    &to DEF,          &none,            &none,            &none,            &none,            &none,            &msc SCRL_UP,     &mkp MB4,         &mmv MOVE_UP,     &mkp MB5,         &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &kp LGUI,         &kp LALT,         &kp LCTRL,        &kp LSHFT,        &none,            &msc SCRL_DOWN,   &mmv MOVE_LEFT,   &mmv MOVE_DOWN,   &mmv MOVE_RIGHT,  &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &mkp RCLK,        &msc SCRL_LEFT,   &msc SCRL_RIGHT,  &none,            &none,           \
// └─────────────────┴─────────────────┴─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┴─────────────────┴─────────────────┘
                                                          &none,            &none,            &mo MSE_F,        &mkp LCLK,        &mkp RCLK,        &none            \
//                                                       └─────────────────┴─────────────────┴─────────────────╨─────────────────┴─────────────────┴─────────────────┘
            )>;
        };

        mouse_fast {
            display-name = "MSE_F";
            bindings = <LAYER_FROM42( \
// ┌─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────╥─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┬─────────────────┐
    &none,            &none,            &none,            &none,            &none,            &none,            &msc SCRL_UP,     &mkp MB4,         &mmv MOVE_UP,     &mkp MB5,         &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &kp LGUI,         &kp LALT,         &kp LCTRL,        &kp LSHFT,        &none,            &msc SCRL_DOWN,   &fmmv MOVE_LEFT,   &fmmv MOVE_DOWN,   &fmmv MOVE_RIGHT,  &none,            &none,           \
// ├─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────┤
    &none,            &none,            &none,            &none,            &none,            &none,            &none,            &mkp RCLK,        &msc SCRL_LEFT,   &msc SCRL_RIGHT,  &none,            &none,           \
// └─────────────────┴─────────────────┴─────────────────┼─────────────────┼─────────────────┼─────────────────╫─────────────────┼─────────────────┼─────────────────┼─────────────────┴─────────────────┴─────────────────┘
                                                          &none,            &none,            &none,            &mkp LCLK,        &mkp RCLK,        &none            \
//                                                       └─────────────────┴─────────────────┴─────────────────╨─────────────────┴─────────────────┴─────────────────┘
            )>;
        };
        extra1 {
            status = "reserved";
        };

        extra2 {
            status = "reserved";
        };
    };
};
